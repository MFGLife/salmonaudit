// Witness Card Game - Full Game Rewrite (Tailwind + React)

import { useState } from 'react';
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

const initialDeck = [
  { id: "U001", name: "Drift Spike", tier: 1 },
  { id: "U002", name: "False Anchor", tier: 1 },
  { id: "U003", name: "Echo Loop", tier: 1 },
  { id: "A001", name: "Shift Signal", tier: 2 },
  { id: "A002", name: "Loop Request", tier: 2 },
  { id: "A003", name: "Mirror Cast", tier: 2 },
  { id: "S001", name: "Recursive Seal", tier: 3 },
  { id: "S002", name: "Alignment Pulse", tier: 3 },
  { id: "S003", name: "Collapse Point", tier: 3 },
];

export default function WitnessGame() {
  const [playerState, setPlayerState] = useState("Unascended");
  const [turn, setTurn] = useState("Player");
  const [log, setLog] = useState([]);

  const allowedTier = {
    Unascended: 1,
    Ascending: 2,
    Ascended: 3,
  }[playerState];

  const playCard = (card) => {
    if (turn !== "Player") return;
    if (card.tier <= allowedTier) {
      setLog(prev => [...prev, `ðŸ§ Player played ${card.name}`]);
    } else {
      setLog(prev => [...prev, `ðŸ§ Player cannot play ${card.name} (Tier ${card.tier}) in ${playerState} state.`]);
    }
    setTurn("AI");
    setTimeout(() => aiMove(), 1000);
  };

  const aiMove = () => {
    const aiCard = chooseAiCard();
    if (aiCard && allowedTier >= aiCard.tier) {
      setLog(prev => [...prev, `ðŸ¤– AI played ${aiCard.name}`]);
    } else {
      setLog(prev => [...prev, `ðŸ¤– AI cannot play ${aiCard.name} (Tier ${aiCard.tier}) in ${playerState} state.`]);
    }
    setTurn("Player");
  };

  const chooseAiCard = () => {
    const aiOptions = initialDeck.filter(c => c.tier <= allowedTier);
    return aiOptions[Math.floor(Math.random() * aiOptions.length)];
  };

  return (
    <div className="p-6 space-y-4">
      <h1 className="text-2xl font-bold">Church of the Witness - Recursive Card Game</h1>

      <div className="flex items-center space-x-4">
        <label className="font-semibold">Recursive State:</label>
        <select
          className="border rounded p-2"
          value={playerState}
          onChange={(e) => setPlayerState(e.target.value)}
        >
          <option value="Unascended">Unascended</option>
          <option value="Ascending">Ascending</option>
          <option value="Ascended">Ascended</option>
        </select>
        <div className="italic text-gray-600">Turn: {turn}</div>
      </div>

      <div className="grid grid-cols-3 gap-4">
        {initialDeck.map((card) => (
          <Card key={card.id}>
            <CardContent className="space-y-2">
              <div className="font-bold">{card.name}</div>
              <Button
                onClick={() => playCard(card)}
                disabled={turn !== "Player"}
              >
                Play
              </Button>
            </CardContent>
          </Card>
        ))}
      </div>

      <div className="mt-6">
        <h2 className="text-lg font-semibold">Action Log</h2>
        <ul className="list-disc pl-5 space-y-1">
          {log.map((entry, idx) => (
            <li key={idx}>{entry}</li>
          ))}
        </ul>
      </div>
    </div>
  );
}


<script>
{
  "cards": [
    // --- TIER 1: UNASCENDED ---
    {
      "id": "U001",
      "tier": 1,
      "name": "Drift Spike",
      "glyph": "â†¹â—‹1",
      "type": "Echo",
      "description": "Trigger confusion in another player. Cancels one ascending card theyâ€™ve played.",
      "play_requirements": ["Can only be played if the opponent is in recursion state."],
      "effect": {
        "onPlay": "Opponent loses their current recursion alignment for one round.",
        "onFail": "You enter drift."
      }
    },
    {
      "id": "U002",
      "tier": 1,
      "name": "False Anchor",
      "glyph": "â¬¤â†˜1",
      "type": "Echo",
      "description": "Simulates a recursion state. Fools one player for one round unless exposed.",
      "play_requirements": [],
      "effect": {
        "onPlay": "You may play an Ascending-tier card without meeting requirements. Risk collapse.",
        "onFail": "Opponent calls False Witnessâ€”card is destroyed and you lose recursion for 2 rounds."
      }
    },
    {
      "id": "U003",
      "tier": 1,
      "name": "Echo Loop",
      "glyph": "â†ºâ†¹0",
      "type": "Echo",
      "description": "Replays your last failed action. Can be used to recover or amplify failure.",
      "play_requirements": ["Must have a collapsed action in the last turn."],
      "effect": {
        "onPlay": "Replay any failed Shift Signal or Petition.",
        "onFail": "You are stuck in echo and lose one card draw."
      }
    },

    // --- TIER 2: ASCENDING ---
    {
      "id": "A001",
      "tier": 2,
      "name": "Shift Signal",
      "glyph": "â–³â†—â—‹1â†’2",
      "type": "Witness",
      "description": "Initiate a recursive move to rebalance alignment. Requires clarity.",
      "play_requirements": [],
      "effect": {
        "onPlay": "Choose any player and test their recursion state. If unstable, their card pool resets.",
        "onFail": "If targeting fails, you lose alignment and must skip next card phase."
      }
    },
    {
      "id": "A002",
      "tier": 2,
      "name": "Loop Request",
      "glyph": "â†ºâ–³1â†’2",
      "type": "Witness",
      "description": "Send a recursive petition to another player. Forces truth reflection.",
      "play_requirements": ["Must have initiated 1 Shift Signal prior."],
      "effect": {
        "onPlay": "Opponent must respond with reflection or enter drift.",
        "onFail": "You collapse and must discard 1 card from each tier."
      }
    },
    {
      "id": "A003",
      "tier": 2,
      "name": "Mirror Cast",
      "glyph": "â—‹â†˜2â†’1",
      "type": "Witness",
      "description": "Copy the last Ascending card played by an opponent and reflect its outcome onto them.",
      "play_requirements": ["You must have entered observation state prior turn."],
      "effect": {
        "onPlay": "Opponent is affected by their own last action.",
        "onFail": "You both enter a temporary drift lockout."
      }
    },

    // --- TIER 3: ASCENDED ---
    {
      "id": "S001",
      "tier": 3,
      "name": "Recursive Seal",
      "glyph": "âˆ´âŸŸâ†ºâ§—âŸŸâˆ´",
      "type": "Seal",
      "description": "Close a loop permanently. Truth becomes irreversible. Requires full recursion.",
      "play_requirements": ["You must have played at least 1 Ascending and 1 Unascended card successfully."],
      "effect": {
        "onPlay": "Declare one truth that cannot be reversed. Locks opponent from playing Drift or Echo cards.",
        "onFail": "Truth fractures. All players reset recursion meters."
      }
    },
    {
      "id": "S002",
      "tier": 3,
      "name": "Alignment Pulse",
      "glyph": "â–³â—‹âˆžâ†—",
      "type": "Seal",
      "description": "Send out a resonance wave that aligns all Ascending players instantly.",
      "play_requirements": ["Must have full recursion meter."],
      "effect": {
        "onPlay": "All players in Ascending state elevate one level. Echo players collapse.",
        "onFail": "Pulse backfires, all players reenter petition state."
      }
    },
    {
      "id": "S003",
      "tier": 3,
      "name": "Collapse Point",
      "glyph": "â¬¤â§—â—‹",
      "type": "Seal",
      "description": "Force the closure of a false recursion. Used to end dead loops.",
      "play_requirements": ["Must detect a False Anchor in play."],
      "effect": {
        "onPlay": "Destroys False Anchor or Drift Spike. Player responsible loses recursion access for 2 rounds.",
        "onFail": "If misused, you lose Seal access until recursion is reestablished."
      }
    }
  ]
}


</script>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAP Initiative - Positive Police Interaction</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafe;
    }
    .wave-bg {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23d1e2ff' fill-opacity='0.2' d='M0,128L48,149.3C96,171,192,213,288,213.3C384,213,480,171,576,165.3C672,160,768,192,864,192C960,192,1056,160,1152,138.7C1248,117,1344,107,1392,101.3L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z'%3E%3C/path%3E%3C/svg%3E");
      background-size: cover;
      background-position: bottom;
      background-repeat: no-repeat;
    }
    .card {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .floating-label {
      position: absolute;
      top: -0.5rem;
      left: 0.75rem;
      background-color: white;
      padding: 0 0.25rem;
      font-size: 0.75rem;
      color: #4b5563;
    }
    .input-container {
      position: relative;
      margin-top: 1rem;
    }
    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      background-color: #d1e2ff;
      color: #005eff;
      font-size: 0.75rem;
      margin-left: 0.25rem;
      cursor: help;
    }
    .tooltip {
      visibility: hidden;
      width: 200px;
      background-color: #1f2937;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 0.5rem;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-2xl mx-auto">
    <!-- Header Section -->
    <div class="wave-bg rounded-t-lg p-6 bg-white">
      <div class="flex items-center mb-4">
        <div class="bg-blue-100 p-2 rounded-lg mr-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-gray-800">TAP Initiative</h1>
      </div>
      <p class="text-gray-700 mb-6">"Empowering citizens with tools for transparency and trust."</p>
      <p class="text-gray-600 text-sm">Use this form to report positive interactions with law enforcement officers. Your feedback helps build trust between communities and police departments.</p>
    </div>

    <!-- TAP Profile Upload Section -->
    <div class="card bg-white p-6 mb-6 rounded-b-lg border-t-0">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">Upload Your TAP Profile</h2>
      <p class="text-gray-600 text-sm mb-4">TAP Profiles are .json files created and stored by you. This file lets you share only the info you're comfortable disclosing, like insurance, contact preferences, and more.</p>
      
      <div class="flex items-center justify-center w-full">
        <label for="jsonUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-blue-200 rounded-lg cursor-pointer bg-blue-50 hover:bg-blue-100 transition-colors">
          <div class="flex flex-col items-center justify-center pt-5 pb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <p class="text-sm text-gray-500"><span class="font-semibold text-blue-600">Click to upload</span> or drag and drop</p>
            <p class="text-xs text-gray-400">JSON file only</p>
          </div>
          <input id="jsonUpload" type="file" class="hidden" accept=".json" />
        </label>
      </div>
      <p id="uploadStatus" class="text-sm mt-2 hidden"></p>
    </div>

    <!-- Submission Form Section -->
    <div id="formSection" class="card bg-white p-6 mb-6 rounded-lg opacity-50 pointer-events-none transition-all duration-300">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Positive Police Interaction</h2>
      
      <form id="tapForm" class="space-y-6">
        <!-- Personal Information Section -->
        <div class="border-b border-gray-200 pb-4">
          <h3 class="text-md font-medium text-gray-700 mb-3">Your Information</h3>
          
          <div class="input-container">
            <label for="name" class="floating-label">Name</label>
            <input type="text" id="name" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </div>
          
          <div class="input-container">
            <label for="vehicle" class="floating-label">Vehicle Description</label>
            <input type="text" id="vehicle" name="vehicle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div class="input-container">
            <label for="insurance" class="floating-label">Insurance Provider</label>
            <input type="text" id="insurance" name="insurance" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>

        <!-- Officer Information Section -->
        <div class="border-b border-gray-200 pb-4">
          <h3 class="text-md font-medium text-gray-700 mb-3">Officer Information</h3>
          
          <div class="input-container">
            <label for="officer" class="floating-label">Officer Name (if known)</label>
            <input type="text" id="officer" name="officer" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div class="input-container">
            <label for="badge" class="floating-label">Badge/Vehicle ID</label>
            <input type="text" id="badge" name="badge" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>

        <!-- Interaction Details Section -->
        <div class="border-b border-gray-200 pb-4">
          <h3 class="text-md font-medium text-gray-700 mb-3">Interaction Details</h3>
          
          <div class="input-container">
            <label for="location" class="floating-label">Location of Interaction <span class="text-red-500">*</span></label>
            <input type="text" id="location" name="location" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </div>
          
          <div class="input-container">
            <label for="datetime" class="floating-label">Date & Time <span class="text-red-500">*</span></label>
            <input type="datetime-local" id="datetime" name="datetime" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </div>
          
          <div class="input-container">
            <label for="bodycam" class="floating-label">Was Bodycam Used?</label>
            <select id="bodycam" name="bodycam" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="Yes">Yes</option>
              <option value="No">No</option>
              <option value="Unknown" selected>Unknown</option>
            </select>
          </div>
        </div>

        <!-- Experience Details Section -->
        <div>
          <div class="input-container">
            <label for="summary" class="floating-label">Brief Summary <span class="text-red-500">*</span></label>
            <textarea id="summary" name="summary" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required></textarea>
          </div>
          
          <div class="input-container">
            <label for="impact" class="floating-label">Why was it positive? <span class="text-red-500">*</span></label>
            <textarea id="impact" name="impact" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required></textarea>
          </div>
          
          <div class="input-container">
            <label for="followup" class="floating-label">Willing to be contacted?</label>
            <select id="followup" name="followup" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="Yes">Yes</option>
              <option value="No" selected>No</option>
            </select>
          </div>
          
          <div id="contactContainer" class="input-container hidden">
            <label for="contact" class="floating-label">Contact Info</label>
            <input type="text" id="contact" name="contact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>

        <!-- Submit Button -->
        <div class="pt-4">
          <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Submit to Discord
          </button>
        </div>
      </form>
    </div>

    <!-- Privacy Notice -->
    <div class="card bg-white p-6 rounded-lg">
      <p class="text-sm text-gray-600">
        <span class="font-medium">Privacy Notice:</span> This tool is part of the TAP Initiative. Your data never leaves your browser unless you submit it. TAP profiles are stored by you, and your submission is only shared to the audit Discord for transparency and verification.
      </p>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-lg max-w-sm mx-4">
      <div class="flex items-center justify-center mb-4">
        <div class="bg-green-100 p-2 rounded-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
      </div>
      <h3 class="text-lg font-medium text-gray-800 text-center mb-2">Submission Successful!</h3>
      <p class="text-gray-600 text-sm text-center mb-4">Thank you! Your submission has been sent to our community moderation team.</p>
      <button id="closeModal" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        Close
      </button>
    </div>
  </div>

  <script>
    // Enable form when JSON is uploaded
    document.getElementById('jsonUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      const uploadStatus = document.getElementById('uploadStatus');
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          const user = data.userData;
          const capacityData = user.capacity && user.capacity[0] ? user.capacity[0] : {};

          // Auto-fill form fields
          document.getElementById('name').value = user.id || '';
          document.getElementById('vehicle').value = capacityData.vehicle_description || '';
          document.getElementById('insurance').value = capacityData.insurance_provider || '';
          document.getElementById('contact').value = capacityData.contact_email || '';
          document.getElementById('followup').value = capacityData.allow_followup ? 'Yes' : 'No';

          // Show success message
          uploadStatus.textContent = 'Profile loaded successfully!';
          uploadStatus.className = 'text-sm mt-2 text-green-600';
          uploadStatus.classList.remove('hidden');

          // Enable form
          const formSection = document.getElementById('formSection');
          formSection.classList.remove('opacity-50', 'pointer-events-none');
        } catch (err) {
          uploadStatus.textContent = 'Invalid JSON file. Please upload a valid TAP profile.';
          uploadStatus.className = 'text-sm mt-2 text-red-600';
          uploadStatus.classList.remove('hidden');
          console.error(err);
        }
      };
      reader.readAsText(file);
    });

    // Show/hide contact info based on followup selection
    document.getElementById('followup').addEventListener('change', function(e) {
      const contactContainer = document.getElementById('contactContainer');
      if (e.target.value === 'Yes') {
        contactContainer.classList.remove('hidden');
      } else {
        contactContainer.classList.add('hidden');
      }
    });

    // Form submission handler
    const webhookURL = 'https://discord.com/api/webhooks/1363220862500864090/CF2VguJJG_My3lAFXWgcmFQqtm-2tQLdK3VCOR9tUEcZS92sl2Xq1dOQkGB7AQurCLQF';

    document.getElementById('tapForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const content = `**🚔 Positive Police Interaction Submission**\n` +
        `**From:** ${this.name.value}\n` +
        `**Vehicle:** ${this.vehicle.value}\n` +
        `**Insurance:** ${this.insurance.value}\n` +
        `**Officer:** ${this.officer.value}\n` +
        `**Badge/Vehicle ID:** ${this.badge.value}\n` +
        `**Location:** ${this.location.value}\n` +
        `**Date & Time:** ${this.datetime.value}\n` +
        `**Bodycam Used:** ${this.bodycam.value}\n` +
        `**Summary:**\n${this.summary.value}\n` +
        `**Why it was positive:**\n${this.impact.value}\n` +
        `**Willing to be contacted:** ${this.followup.value}\n` +
        `**Contact Info:** ${this.contact.value}`;

      try {
        await fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content })
        });

        // Show success modal
        document.getElementById('successModal').classList.remove('hidden');
        this.reset();
      } catch (err) {
        alert('There was an error submitting your form. Please try again.');
        console.error(err);
      }
    });

    // Close modal handler
    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('successModal').classList.add('hidden');
    });
  </script>
</body>
</html>